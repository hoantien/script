#!/bin/bash


############ Preview Off & Trigger Off ###########
adb shell "echo 5 0x004E 0x00 0x01 0x02 0xB4 0x00  > /sys/class/light_ccb/i2c_interface/i2c_w"
adb shell "echo 9 0x004E 0x00 0x01 0x06 0xE4 0x00 0xFE 0x07 0x00 0x00 > /sys/class/light_ccb/i2c_interface/i2c_w"

############ Set RDI & Slave mode #############
sh set_rdi.sh
sleep 5
sh slave_mode.sh
sleep 5

############ CIT = 0x0068 * 7600, Gain = 0x1007 ##############

# set gain for both A & B cams
adb shell "echo 15 0x004E 0x00 0x01 0x0C 0x82 0x00 0xFE 0x07 0x00 0x00 0x6C 0x03 0x30 0x5E 0x10 0x07 > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1
adb shell "echo 9 0x004E 0x00 0x01 0x06 0x83 0x00 0xFE 0x07 0x00 0x00  > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1

##### A CAMS #####
# set llpclk for A cams
adb shell "echo 15 0x004E 0x00 0x01 0x0C 0x82 0x00 0x3E 0x00 0x00 0x00 0x6C 0x03 0x30 0x0C 0x1D 0xB0 > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1
adb shell "echo 9 0x004E 0x00 0x01 0x06 0x83 0x00 0x3E 0x00 0x00 0x00  > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1

# set fll for A cams
adb shell "echo 15 0x004E 0x00 0x01 0x0C 0x82 0x00 0x3E 0x00 0x00 0x00 0x6C 0x03 0x03 0x40 0x09 0xCF > /sys/class/light_ccb/i2c_interface/i2c_w"
#adb shell "echo 15 0x004E 0x00 0x01 0x0C 0x82 0x00 0x3E 0x00 0x00 0x00 0x6C 0x03 0x03 0x40 0x00 0x69 > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1
adb shell "echo 9 0x004E 0x00 0x01 0x06 0x83 0x00 0x3E 0x00 0x00 0x00  > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1

# set exposure for A cams
adb shell "echo 15 0x004E 0x00 0x01 0x0C 0x82 0x00 0x3E 0x00 0x00 0x00 0x6C 0x03 0x02 0x02 0x00 0x68 > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1
adb shell "echo 9 0x004E 0x00 0x01 0x06 0x83 0x00 0x3E 0x00 0x00 0x00  > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1


##### B CAMS #####
# set llpclk for B cams
adb shell "echo 15 0x004E 0x00 0x01 0x0C 0x82 0x00 0xC0 0x07 0x00 0x00 0x6C 0x03 0x30 0x0C 0x0E 0xD8 > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1
adb shell "echo 9 0x004E 0x00 0x01 0x06 0x83 0x00 0xC0 0x07 0x00 0x00  > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1

# set fll for B cams
adb shell "echo 15 0x004E 0x00 0x01 0x0C 0x82 0x00 0xC0 0x07 0x00 0x00 0x6C 0x03 0x03 0x40 0x13 0x9E > /sys/class/light_ccb/i2c_interface/i2c_w"
#adb shell "echo 15 0x004E 0x00 0x01 0x0C 0x82 0x00 0xC0 0x07 0x00 0x00 0x6C 0x03 0x03 0x40 0x00 0xD2 > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1
adb shell "echo 9 0x004E 0x00 0x01 0x06 0x83 0x00 0xC0 0x07 0x00 0x00  > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1

# set exposure for B cams
adb shell "echo 15 0x004E 0x00 0x01 0x0C 0x82 0x00 0xC0 0x07 0x00 0x00 0x6C 0x03 0x02 0x02 0x00 0xD0 > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1
adb shell "echo 9 0x004E 0x00 0x01 0x06 0x83 0x00 0xC0 0x07 0x00 0x00  > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1

# Configure trigger
adb shell "echo 21 0x004E 0x00 0x01 0x12 0xE0 0x00 0x01 0xFF 0xFE 0x00 0x01 0x00 0xA0 0x86 0xB6 0x00 0xB0 0x57 0xFF 0xFF 0xFF 0xFF > /sys/class/light_ccb/i2c_interface/i2c_w"
#adb shell "echo 21 0x004E 0x00 0x01 0x12 0xE0 0x00 0x01 0xFF 0xFE 0x00 0x01 0x00 0xA0 0x86 0x06 0x00 0xAF 0x29 0xFF 0xFF 0xFF 0xFF > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1

############# Discard some initial frames ###############
adb shell "echo 9 0x004E 0x00 0x01 0x06 0xE2 0x00 0xFE 0x07 0x00 0x00 > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 10
adb shell "echo 9 0x004E 0x00 0x01 0x06 0xE4 0x00 0xFE 0x07 0x00 0x00 > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1

# Snapshot
adb shell "echo 9 0x004E 0x00 0x01 0x06 0xB2 0x00 0xFE 0x07 0x00 0x00  > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 1

# Trigger on
adb shell "echo 9 0x004E 0x00 0x01 0x06 0xE2 0x00 0xFE 0x07 0x00 0x00 > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 10

############ JH's mm-qcamera-app with only transfer frames ##############
adb shell "mm-qcamera-app AB test_exp1 /sdcard/DCIM/rdi/ trigger"
sleep 10

# Trigger off
adb shell "echo 9 0x004E 0x00 0x01 0x06 0xE4 0x00 0xFE 0x07 0x00 0x00 > /sys/class/light_ccb/i2c_interface/i2c_w"
sleep 5

############ Check if FPGA was being reset ##############
## If readback fails to match expected value, FPGA was being reset before this point
echo "Checking if FPGA is being reset. If readback fails to match expected value, FPGA was being reset before this point"
sh verify_simple.sh
sleep 5



